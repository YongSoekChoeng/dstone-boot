# Dstone Boot Application(프레임웍) Docker 빌드 및 실행 가이드

---

## 1. 컨테이너 구성 개요

본 프로젝트는 Docker Compose를 사용하여 아래 **4개의 컨테이너**를 구성합니다.

1. **dstone-mysql** : 데이터베이스 (MySQL)
2. **dstone-rabbitmq** : 메시지 큐 (RabbitMQ)
3. **dstone-redis** : 캐시 서버 (Redis)
4. **dstone-boot** : Application 프레임워크

모든 컨테이너는 **일괄 실행** 또는 **개별 실행**이 가능합니다.

---

## 2. 사전 작업

1. 작업 디렉토리 결정
2. 템플릿 복사

```text
/workshop
```

---

## 3. WSL 호스트 디렉토리 구조

### 3.1 WORK_ROOT

```text
/workshop
```

---

### 3.2 Boot Application

```text
/workshop/dstone-boot
 ├─ conf/                 # 설정 파일
 ├─ target/               # 실행 파일
 ├─ 01.dstone-boot-docker.yml
 └─ 02.dstone-boot-docker-reg.sh
```

---

### 3.3 Database (MySQL)

```text
/workshop/dstone-mysql
 ├─ init-db/              # DB 초기화 스크립트
 ├─ target/
 ├─ 01.dstone-mysql-docker.yml
 └─ 02.dstone-mysql-docker-reg.sh
```

---

### 3.4 RabbitMQ

```text
/workshop/dstone-rabbitmq
 ├─ init-data/            # 초기 데이터
 ├─ 01.dstone-rabbitmq-docker.yml
 └─ 02.dstone-rabbitmq-docker-reg.sh
```

---

### 3.5 Redis

```text
/workshop/dstone-redis
 ├─ 01.dstone-redis-docker.yml
 └─ 02.dstone-redis-docker-reg.sh
```

---

### 3.6 메인 Docker Compose 위치

```text
/workshop/dstone-boot-docker-compose.yml
```

---

## 4. 사전작업

### 4.1 작업디렉토리로 이동
```bash
cd /workshop
```

### 4.2 사용자 변경, 파일권한 변경
```bash
chown -R root:root *
chmod -R 777 *
```

### 4.3 dos2unix 로 파일포맷 변환
아래의 알리아스 설정하여 하위디렉토리까지 dos2unix 명령 적용할 준비 진행.
- alias cdos='find . -type f \( -name "*.sh" -o -name "*.sql" -o -name "*.yml" \) -exec dos2unix {} \;'

```bash
cdos
```

---

## 5. 작업 명령 – 일괄 실행 (docker-compose.yml)

### 5.1 Docker Compose 실행

```bash
docker-compose -p dstone -f /workshop/dstone-boot-docker-compose.yml up -d
```

### 5.2 로그 확인

```bash
docker-compose -p dstone -f /workshop/dstone-boot-docker-compose.yml logs -f
```

### 5.3 중지 및 삭제(볼륨을 그대로 두려면 -v 옵션을 제거)

```bash
docker-compose -p dstone -f /workshop/dstone-boot-docker-compose.yml down -v
```

---

## 6. 작업 명령 – 개별 실행 (서비스별 docker yml)

### 6.1 Docker Compose 실행

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml up -d

# Redis
docker-compose -p dstone -f /workshop/dstone-redis/01.dstone-redis-docker.yml up -d

# RabbitMQ
docker-compose -p dstone -f /workshop/dstone-rabbitmq/01.dstone-rabbitmq-docker.yml up -d

# Application
docker-compose -p dstone -f /workshop/dstone-boot/01.dstone-boot-docker.yml up -d
```

> ⚠️ **주의사항**  
> 개별 실행 시 반드시 **dstone-mysql을 먼저 실행**해야 합니다.  
> 나머지 컨테이너는 순서에 관계없이 실행 가능합니다.

---

### 6.2 로그 확인

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml logs -f dstone-mysql

# Redis
docker-compose -p dstone -f /workshop/dstone-redis/01.dstone-redis-docker.yml logs -f dstone-redis

# RabbitMQ
docker-compose -p dstone -f /workshop/dstone-rabbitmq/01.dstone-rabbitmq-docker.yml logs -f dstone-rabbitmq

# Application
docker-compose -p dstone -f /workshop/dstone-boot/01.dstone-boot-docker.yml logs -f dstone-boot
```

---

### 6.3 중지 및 삭제(볼륨을 그대로 두려면 -v 옵션을 제거)

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml down -v

# Redis
docker-compose -p dstone -f /workshop/dstone-redis/01.dstone-redis-docker.yml down -v

# RabbitMQ
docker-compose -p dstone -f /workshop/dstone-rabbitmq/01.dstone-rabbitmq-docker.yml down -v

# Application
docker-compose -p dstone -f /workshop/dstone-boot/01.dstone-boot-docker.yml down -v
```

---

## 7. Docker Hub 이미지 등록

각 서비스별 Docker 이미지를 Docker Hub에 등록할 수 있습니다.

```text
/workshop/dstone-mysql/02.dstone-mysql-docker-reg.sh
/workshop/dstone-redis/02.dstone-redis-docker-reg.sh
/workshop/dstone-rabbitmq/02.dstone-rabbitmq-docker-reg.sh
/workshop/dstone-boot/02.dstone-boot-docker-reg.sh
```

---

## 8. 정리

- **일괄 실행**: 전체 서비스 한 번에 기동
- **개별 실행**: 서비스 단위 테스트 및 개발
- **MySQL 우선 기동 필수**
- `down -v` 옵션 사용 시 **데이터 볼륨 삭제 주의**

---

